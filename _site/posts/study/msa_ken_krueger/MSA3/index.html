<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Microservices with Spring Cloud 3 - Spring Cloud &middot; 이기승의 끄적끄적..
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
<link rel="stylesheet" href="/public/css/ntz4kiseung.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>
    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <!-- Profile -->
  <div class="sidebar-item sidebar-profile-box">
    <img class="sidebar-profile-image" src="/public/image/About Me/sidebar_profile.png" >
    <div class="sidebar-profile-description">
      <span>
        &nbsp;잡기에 능한 개발자입니다. 잡기보다 개발 실력이 좋아야 할 텐데 걱정입니다.
      </span>
    </div>
  </div>
  <!-- Profile End -->

  <nav class="sidebar-nav">
    <!-- Home -->
    <a class="sidebar-nav-item" href="/">Home</a>
    <!-- Home End -->
    <!-- Posts -->
    
    
      
        <!-- 1 depth post -->
        <a class="sidebar-nav-item" href="http://localhost:4000/posts/About Me">About Me</a>
      
    
      
        <!-- 1 depth post -->
        <a class="sidebar-nav-item" href="http://localhost:4000/posts/Daily Thoughts">Daily Thoughts</a>
      
    
      
        <input id="Projects" class="toggle" type="checkbox">
        <label for="Projects" class="lbl-toggle sidebar-nav-item" tabindex="0">Projects</label>
        <div class="collapsible-content subcategories">
        
          
            <!-- 2 depth post -->
            <a class="sidebar-nav-item" href="http://localhost:4000/posts/Projects/Sagyo_Reboot">Sagyo_Reboot</a>
          
        
          
            <!-- 2 depth post -->
            <a class="sidebar-nav-item" href="http://localhost:4000/posts/Projects/Twitch_Chat_Analysis">Twitch_Chat_Analysis</a>
          
        
          
            <!-- 2 depth post -->
            <a class="sidebar-nav-item" href="http://localhost:4000/posts/Projects/Hwangmaesan">Hwangmaesan</a>
          
        
          
            <!-- 2 depth post -->
            <a class="sidebar-nav-item" href="http://localhost:4000/posts/Projects/The_Oyster_Mine">The_Oyster_Mine</a>
          
        
        </div>
      
    
      
        <input id="Study" class="toggle" type="checkbox">
        <label for="Study" class="lbl-toggle sidebar-nav-item" tabindex="0">Study</label>
        <div class="collapsible-content subcategories">
        
          
            <!-- 2 depth post -->
            <a class="sidebar-nav-item" href="http://localhost:4000/posts/Study/Http The Definitive Guide">Http The Definitive Guide</a>
          
        
          
            <!-- 2 depth post -->
            <a class="sidebar-nav-item" href="http://localhost:4000/posts/Study/C_Kim_Pope">C_Kim_Pope</a>
          
        
          
            <!-- 2 depth post -->
            <a class="sidebar-nav-item" href="http://localhost:4000/posts/Study/MSA_Ken_Krueger">MSA_Ken_Krueger</a>
          
        
        </div>
      
    
      
        <input id="Googling" class="toggle" type="checkbox">
        <label for="Googling" class="lbl-toggle sidebar-nav-item" tabindex="0">Googling</label>
        <div class="collapsible-content subcategories">
        
          
            <!-- 2 depth post -->
            <a class="sidebar-nav-item" href="http://localhost:4000/posts/Googling/etc">etc</a>
          
        
          
            <!-- 2 depth post -->
            <a class="sidebar-nav-item" href="http://localhost:4000/posts/Googling/java">java</a>
          
        
          
            <!-- 2 depth post -->
            <a class="sidebar-nav-item" href="http://localhost:4000/posts/Googling/jekyll">jekyll</a>
          
        
          
            <!-- 2 depth post -->
            <a class="sidebar-nav-item" href="http://localhost:4000/posts/Googling/linux">linux</a>
          
        
        </div>
      
    
    <!-- Posts End -->
  </nav>

  <!-- sidebar bottom -->
  <div class="sidebar-item">
    <p>
      &copy; 2020. All rights reserved.
    </p>
  </div>
  <!-- sidebar bottom end -->
</div>

    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title" style="font-weight: normal;">
            <a href="/" title="Home">이기승의 끄적끄적..</a>
            <small>개발 및 잡다한 포스팅</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">Microservices with Spring Cloud 3 - Spring Cloud</h1>
  <span class="post-date">24 Apr 2020</span>
  
<ul>
  <li>본 포스팅은 Ken Krueger 선생님의 <a href="https://www.udemy.com/course/microservices-with-spring-cloud/">Microservices with Spring Cloud</a> 강의를 정리하며 사견을 붙인 것입니다.</li>
  <li>포스팅 내 목차는 개별 동영상 강의 기준입니다.</li>
</ul>

<h2 id="11-spring-cloud-overview">11. Spring Cloud Overview</h2>

<hr />

<ul>
  <li>우선 Spring Cloud가 무엇인지를 알아봅시다.</li>
</ul>

<h3 id="111-spring-cloud-origins">11.1. Spring Cloud Origins</h3>

<ul>
  <li>Spring 프레임워크엔 다양한 sub project 들이 있습니다. 이 sub project들은 모두 Spring IO 아래 있습니다.
    <ul>
      <li>Spring Security, Web Flow, Integration, Data, Boot …</li>
    </ul>
  </li>
  <li>Spring Cloud 역시 Spring IO 아래 있는 기술입니다. Spring Cloud 아래엔 다음과 같은 기술들이 있습니다.
    <ul>
      <li>Spring Cloud Config</li>
      <li>Spring Cloud Netflix
        <ul>
          <li>Eureka</li>
          <li>Hystrix</li>
          <li>Zuul</li>
          <li>Ribbon</li>
          <li>etc…</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="112-spring-cloud의-목적">11.2. Spring Cloud의 목적</h3>

<ul>
  <li>Spring Cloud의 목적은 클라우드 기반의 어플리케이션을 만드는데 필요한 것들을 제공하는 것입니다.
    <ul>
      <li>클라우드 기반 어플리케이션이란 volatile 환경에서 운영되는 distributed 어플리케이션을 말합니다.</li>
    </ul>
  </li>
  <li>distributed 어플리케이션엔 다음과 같은 것들이 필요합니다. Spring Cloud가 아래와 같은 기능을 제공해주나 봅니다.
    <ul>
      <li>Distributed / Versioned / Centralized Configuration Management.</li>
      <li>Service Registeration and Discovery</li>
      <li>Load Balancing</li>
      <li>Service to service calls</li>
      <li>Circuit breakers</li>
      <li>Routing</li>
    </ul>
  </li>
</ul>

<h3 id="113-spring-cloud-netflix">11.3. Spring Cloud Netflix</h3>

<ul>
  <li>Spring Cloud 얘기를 하려면 넷플릭스 얘기를 해야 합니다.</li>
  <li>넷플릭스는 2007년 시스템을 완전히 개편해야 했습니다. 당시 개편을 할 때 넷플릭스는 전에 아무도 하지 않은 일을 시도합니다. AWS를 이용해 완전한 클라우드 환경으로 시스템을 재편하는 것입니다.</li>
  <li>당시엔 시스템 전체를 클라우드에 올려 운영하는 회사가 없었습니다. 넷플릭스는 클라우드 환경에 작업하기 위한 툴들을 직접 개발했습니다. 그리고 그 기술들을 오픈 소스로 공개했습니다!
    <ul>
      <li>물론, 넷플릭스의 핵심 기술인 비디오 스트리밍 관련한 기술들은 비밀입니다. 🤫</li>
    </ul>
  </li>
  <li>넷플릭스 팀은 많은 유용한 툴들을 오픈 소스로 개발해냈습니다. 넷플릭스가 만든 툴들은 퀄리티가 좋았지만, 일반 사용자들이 사용하기엔 꽤나 어려웠습니다.
    <ul>
      <li>이때, Spring 팀이 들어왔습니다. Spring 에서 넷플릭스가 만든 오픈소스 기술들을 더 사용하기 쉽게 만들어 줬습니다.</li>
    </ul>
  </li>
  <li>곧 알게되겠지만 Spring Cloud 에선 넷플릭스 라이브러리들을 사용하기 매우 쉽습니다. 의존성을 추가하고 어노테이션을 다는 정도면 끝납니다.</li>
</ul>

<h3 id="114-몇가지-컨셉">11.4. 몇가지 컨셉</h3>

<ul>
  <li>
    <p>우선, Spring Cloud 프로젝트는 Spring Boot에 기반해 만들어 집니다.</p>

    <ul>
      <li>하지만 어플리케이션 실행 프로세스가(ApplicationContext startup process) 조금 다릅니다. 이 강의에선 여기 까진 안나갈 겁니다.</li>
    </ul>
  </li>
  <li>
    <p>이 강의를 진행하면 ‘Client’ 와 ‘Server’의 용어에 대해 헷갈리지 마시길 바라겠습니다.</p>

    <ul>
      <li>MSA에서 클라이언트와 서버는 누가 누굴 부르냐에 따라 정해집니다. 어떤 서비스도 클라이언트가 될 수도 있고 서버가 될 수도 있습니다.</li>
    </ul>
  </li>
  <li>
    <p>Spring Boot pom.xml의 &lt;parent&gt; 부분을 바꿔줘야 합니다. boot 를 cloud를 바꾸고 버전을 좀 바꿔줘야 합니다.</p>

    <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;parent&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-parent<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>Angel.SR4<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/parent&gt;</span>
</code></pre></div>    </div>

    <ul>
      <li>Spring Cloud는 빠르게 버전업 되고 있어서 강의가 진행될 때랑 수강할 때랑 좀 다를 수 있습니다.</li>
    </ul>
  </li>
</ul>

<h2 id="12-spring-cloud-configuration---centralized-versioned-configuration---part-1">12. Spring Cloud Configuration - Centralized, Versioned Configuration - Part 1</h2>

<hr />

<ul>
  <li>이번 강의에선 중앙집중적이고 버전닝이 가능한 distributed 어플리케이션을 위한 설정 관리 방법 - Spring Cloud Config를 알려드리겠습니다.
    <ul>
      <li>Centralized, versioned configuration management for distributed applications</li>
    </ul>
  </li>
  <li>이번 강의 학습목표입니다.
    <ul>
      <li>Spring Cloud Config가 뭔지 설명가능해지기</li>
      <li>Spring Cloud Config Server 빌드하고 실행하기</li>
      <li>Repository 만들기</li>
      <li>클라이언트 빌드하고 실행하고 Configure 하기</li>
    </ul>
  </li>
</ul>

<h3 id="121-application-configuration은-무엇인가요">12.1. Application Configuration은 무엇인가요</h3>

<ul>
  <li>어플리케이션은 단순히 코드가 아닙니다. 리소스나 다른 어플리케이션에도 접근해야 합니다.</li>
  <li>이런 어플리케이션을 제어하기 위해 외부 configuration을 사용합니다.
    <ul>
      <li>어플리케이션 코드 안에 하드코딩 하는 방법은 모두가 지양합니다.</li>
      <li>보통 어플리케이션 내부에서 사용하는 설정 xml 파일 등을 말하는게 아닙니다. 이 강좌에선 external configuration에 대해 말할 겁니다.</li>
    </ul>
  </li>
</ul>

<h3 id="122-configuration의-방법들">12.2. Configuration의 방법들</h3>

<ul>
  <li>우선 파일 안에 하드코딩 하는 방법은 제외합시다.</li>
  <li>전통적인 방법으로, 어플리케이션 안에 설정 파일을 두는 방법이 있습니다.
    <ul>
      <li>해당 설정을 적용하려면 다시 빌드하거나 실행해야 합니다.</li>
    </ul>
  </li>
  <li>어플리케이션 밖으로 빼서 다른 곳에 설정 파일을 둘 수도 있습니다.
    <ul>
      <li>클라우드 환경에 적용시키지 못합니다. 클라우드 환경에서 일반 파일 시스템을 사용하려고 한다면 꽤나 귀찮습니다. 설정 파일 하나 올리려 클라우드 환경에 파일 시스템을 도입하는건 무리입니다.</li>
    </ul>
  </li>
  <li>환경 변수를 사용하는 방법도 있습니다.
    <ul>
      <li>환경 변수는 플랫폼마다 사용하는 방법이 다르기 때문에 플랫폼을 고정시켜야 합니다.</li>
      <li>고정 시켰다고 해도, 많은 설정들을 환경 변수로 다루려면 관리하기 까다롭습니다.(놓치기 쉽습니다.)</li>
    </ul>
  </li>
  <li>Cloud-Vendor specific solution을 사용하는 방법도 있습니다. 이 강의에선 Heroku를 사용합니다.
    <ul>
      <li>Heroku 같은 것도 사실 기본적으론 환경 변수를 사용하지만 더 관리하기 쉽습니다.</li>
    </ul>
  </li>
</ul>

<h3 id="123-다른-challenge들">12.3. 다른 Challenge들</h3>

<ul>
  <li>Microservices - 마이크로 서비스들을 만들면 많은 의존성이 생기고 이것들을 전통적인 방법으로 관리하긴 힘듭니다. 넷플릭스는 600여 개의 마이크로서비스가 있다고 합니다.</li>
  <li>Dynamic updates - 설정들이 자동으로 업데이트 되어야 합니다.</li>
  <li>Version Control - 버전 관리도 되면 당연히 좋습니다.</li>
</ul>

<h3 id="124-configuration-관리에-바라는-것들">12.4. Configuration 관리에 바라는 것들</h3>

<ul>
  <li>플랫폼, 클라우드, 개발언어 등에 독립적이어야 합니다.</li>
  <li>중앙화 되어야 합니다.</li>
  <li>동적으로 업데이트되고 실행되어야 합니다.</li>
  <li>Controllable 해야합니다. Source Code Management 툴을 고를때와 마찬가지로 말입니다.</li>
  <li>Passive해야 합니다.(운영자 입장에서 스스로 active 하게 컨트롤하는게 아니라 서비스들이 알아서 컨트롤 되는걸 뜻하는 것 같습니다.) 각 서비스들이 설정 관리를 스스로 해야합니다.</li>
</ul>

<h3 id="125-그에-대한-solution">12.5. 그에 대한 Solution!</h3>

<ul>
  <li>Spring Cloud Config
    <ul>
      <li>설정 관리를 중앙화 할 수 있고, 다른 서비스로부터 외부화 할 수 있으며, 보안도 할 수 있고 다른 서비스들이 접근하기도 쉽습니다.</li>
    </ul>
  </li>
  <li>Spring Cloud Bus
    <ul>
      <li>설정이 변경되었을 때 다른 서비스들이 알아차릴 수 있게 해줍니다. (provide simple way to push changes out)</li>
    </ul>
  </li>
  <li>Spring Cloud Netflix Eureka
    <ul>
      <li>Service Discovery를 해줍니다. 서비스들이 자기 자신을 클라이언트로 등록하게 해줍니다.</li>
    </ul>
  </li>
</ul>

<h3 id="126-spring-cloud-config">12.6. Spring Cloud Config</h3>

<ul>
  <li>configuration을 제공해주는 중앙화된 서버입니다.</li>
  <li>다른 서비스들이 시작될 때 이 설정 서버로 HTTP 요청을 보내 설정 정보를 받아갑니다.</li>
  <li>Spring Cloud Config 에는 Server와 Client가 있습니다.</li>
</ul>

<h3 id="127-spring-cloud-config-server">12.7. Spring Cloud Config Server</h3>

<ul>
  <li>깃헙에서 서버를 받을 수 있습니다.
    <ul>
      <li><a href="https://github.com/spring-cloud/spring-cloud-config">https://github.com/spring-cloud/spring-cloud-config</a></li>
    </ul>
  </li>
  <li>스스로 빌드할 수도 있습니다! 쉽습니다!</li>
</ul>

<h3 id="127-spring-cloud-config-server-만들기">12.7. Spring Cloud Config Server 만들기</h3>

<ul>
  <li>
    <p>Spring Boot 프로젝트를 하나 만들어서 pom.xml을 다음과 같이 수정합시다.</p>

    <ul>
      <li>Spring cloud 버전은 그때 stable한 최신의 버전을 쓰는게 맞지만 일단.. 강의에 있는걸 쓰겠습니다..</li>
    </ul>

    <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;parent&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-parent<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>Angel.SR4<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/parent&gt;</span>
  
<span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spring-cloud-config-server<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>application.properties를 application.yml로 바꾸고 아래와 같은 설정을 넣어줍니다.</p>

    <ul>
      <li>uri, searchPaths 부분에 나중에 실제로 쓰일 설정 파일의 경로를 넣어주면 됩니다.</li>
      <li>git은 원격에 파일을 놓을 때, native는 서버가 돌아가는 파일시스템 상에 놓을 때 입니다.</li>
    </ul>

    <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>---
spring:
  cloud:
    config:
      server:
        git:
          uri: https://github.com/kennyk65/Microservices-With-Spring-Student-Files
          searchPaths: ConfigData
        native:
          searchLocations: classpath:offline-repository/
server:
  port: 8001
</code></pre></div>    </div>
  </li>
  <li>
    <p>Application에 다음과 같이 <code class="highlighter-rouge">@EnableConfigServer</code> 어노테이션을 추가합니다.</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootApplication</span>
<span class="nd">@EnableConfigServer</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConfigServerApplication</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">ConfigServerApplication</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>끝났습니다! 이것만 하면 Spring Cloud Config Server를 만든 겁니다!</p>
  </li>
</ul>

<h2 id="13-spring-cloud-configuration---centralized-versioned-configuration---part-2">13. Spring Cloud Configuration - Centralized, Versioned Configuration - Part 2</h2>

<hr />

<h3 id="131-spring-cloud-config-client-만들기">13.1. Spring Cloud Config Client 만들기</h3>

<ul>
  <li>
    <p>Spring Boot 프로젝트를 만들고 아래의 dependency management를 pom.xml에 추가합니다.</p>

    <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependencyManagement&gt;</span>
    <span class="nt">&lt;dependencies&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-parent<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>Angel.SR4<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
            <span class="nt">&lt;scope&gt;</span>import<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>
<span class="nt">&lt;/dependencyManagement&gt;</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>기존의 dependencies엔 아래 의존성을 추가해줍니다.</p>

    <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-config<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>다음으로 설정 파일을 받아올 Config Server를 설정해야 합니다. properties 파일에 설정 할 수도 있고 yml 파일에 설정할 수도 있습니다. 설정 파일이름은 bootstrap.properties / bootstrap.yml 입니다.</p>

    <ul>
      <li>
        <p>bootstrap.properties 일 경우</p>

        <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># bootstrap.properties:
spring.application.name : {server name}
spring.cloud.config.uri : http://{server ip}:{server port}
</code></pre></div>        </div>
      </li>
      <li>
        <p>bootstrap.yml 일 경우</p>

        <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>spring:
  application:
    name: {server name}
      
  cloud:
    config:
      uri: http://{server ip}:{server port}
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>끝입니다! 이렇게 설정해두면 클라이언트가 켜질 때 등록된 설정 서버로 HTTP 요청을 보내 설정을 받아옵니다.</p>

    <ul>
      <li>Spring Cloud Config가 아닌 다른 클라이언트 서버를 사용한다면 어플리케이션이 켜질 때 Spring Cloud config 서버로 HTTP를 보내고 결과를 처리하는 걸 직접 구현해야 합니다.
        <ul>
          <li>결과는 json으로 옵니다.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="132-environmentrepository">13.2. EnvironmentRepository</h3>

<ul>
  <li>
    <p>앞서 살펴봤듯이 Config server는 설정 파일을 클라우드에 가지고 있을 수도 있고, 프로젝트나 파일 시스템 안에 native 하게 가지고 있을 수도 있습니다.</p>
  </li>
  <li>
    <p>만약 기본 설정 파일이 아닌 다른 설정 파일을 사용하고 싶다면 EnvironmentRepository 를 구현하면 됩니다.</p>
  </li>
  <li>
    <p>구현 하는 방법은 간단합니다.</p>

    <ul>
      <li>{spring.application.name}-{profile}.yml / {spring.application.name}-{profile}.properties 를 만들어줍니다.
        <ul>
          <li>{spring.application.name} 은 위에서도 나왔던 어플리케이션 이름이고</li>
          <li>{profile} 은 클라이언트의 spring.profiles.active 중 하나입니다.</li>
        </ul>
      </li>
      <li>가져오는 uri는 http://{server}:{port}/{spring.application.name}/{profile} 으로 합니다.</li>
    </ul>
  </li>
  <li>
    <p>다음과 같이 서버에 여러 repository들을 구성 할 수 있습니다. 여기서 이름이 “application-sample” 이고 profile이 “asia”인 클라이언트가 요청을 한다면 아래 중 맞는 설정 파일만 포함해 돌려줍니다.</p>

    <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>application-sample-default.yml
application-sample.yml			# picked!
application-sample-europe.yml
application-sample-asia.yml		# picked!
application-sample.properties	# picked!
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="133-yml-vs-properties">13.3. .yml vs .properties</h3>

<ul>
  <li>
    <p>둘 다 장단점이 있지만, 기본적으로 Config Server는 yml 파일을 선호합니다.</p>
  </li>
  <li>
    <p>yml 파일은 <code class="highlighter-rouge">---</code>로 시작합니다. 공백 2개를 indentation으로 해서 값들의 위계를 구분합니다.</p>
  </li>
  <li>
    <p>yml은 여러 profile을 한 파일안에 담을 수 있습니다.</p>

    <ul>
      <li>
        <p>properties 파일이라면 다음과 같이 2개의 파일을 만들어야 합니다.</p>

        <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># app-sample-east.properties
app-sample : Clover
</code></pre></div>        </div>

        <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># app-sample-west.properties
app-sample : Rabbit
</code></pre></div>        </div>
      </li>
      <li>
        <p>yml은 <code class="highlighter-rouge">---</code>를 이용해 한 파일에 구성할 수 있습니다.</p>

        <p>```</p>
        <h1 id="app-sampleyml">app-sample.yml</h1>
        <hr />
        <p>spring:
  profiles: east
app-sample: Clover</p>
      </li>
    </ul>

    <hr />
    <p>spring:
    profiles: west
  app-sample: Rabbit
  ```</p>
  </li>
</ul>

<h3 id="134-클라이언트가-어떻게-동작-하는지">13.4. 클라이언트가 어떻게 동작 하는지</h3>

<ul>
  <li>Spring 어플리케이션에는 Environment 객체가 있습니다. Environment. 해서 환경값을 가져와본적 있을 것입니다.</li>
  <li>Environment 객체는 PropertySources 를 여러개 가지고 있습니다.(property를 가져오는 소스별로 따로 만들어지는 객체 같습니다.)
    <ul>
      <li>기본적으로 Spring 애플리케이션은 환경 변수, system properties, JNDI 등에서 properties를 가져옵니다.</li>
    </ul>
  </li>
  <li>Spring Cloud Config Client가 실행될때 설정 서버로 HTTP 요청을 보내 결과를 받고, 결과를 새로운 PropertySource에 넣습니다.</li>
</ul>

<h3 id="135-spring-cloud-config-client가-아니면-어떻게-하죠-">13.5. Spring Cloud Config Client가 아니면 어떻게 하죠? 😥</h3>

<ul>
  <li>HTTP 통신이 되는 어플리케이션이면 모두 가능합니다.</li>
  <li>다만, 설정 서버로 HTTP 요청을 보내고, 받은 설정을 애플리케이션에 설정하는 과정은 직접 구현해야 합니다.
    <ul>
      <li>웬만한 웹 프레임워크면 쉽게 보내고 설정 할 수 있을 것입니다.</li>
    </ul>
  </li>
</ul>

<h3 id="136-config-server가-죽으면-어떻게-하죠">13.6. Config Server가 죽으면 어떻게 하죠?</h3>

<ul>
  <li>우선 Spring Cloud Config Server는 기본적으로 여러 인스턴스가 돌고 있습니다. 하나가 죽어도 상관 없습니다.</li>
  <li>Client 단에서도 설정을 가져오는 서버가 죽으면 어떻게 행동할지 설정할 수 있습니다.</li>
  <li>Config 서버에서 가져온 설정이 local setting을 덮어쓰게 되는데, 서버에서 가져오지 못하면 local setting으로 실행 되게 할 수도 있습니다. (provide local fallback setting)</li>
</ul>

<h2 id="14-lab-3---spring-cloud-configuration">14. Lab 3 - Spring Cloud Configuration</h2>

<hr />

<ul>
  <li>설정 서버, 클라이언트르 설정하는 실습입니다.</li>
</ul>

</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/posts/study/c_kim_pope/C3-2/">
            C Unmanaged Programming 2 - 빌드과정
            <small>24 Apr 2020</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/posts/study/c_kim_pope/C3/">
            C Unmanaged Programming 2 - C언어 기본 문법2
            <small>23 Apr 2020</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/posts/study/msa_ken_krueger/MSA2/">
            Microservices with Spring Cloud 2 - Modern Spring - Spring Boot, Spring Data, and Spring Data REST
            <small>22 Apr 2020</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>

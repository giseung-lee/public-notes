<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      디렉터리 구조 개편 및 MSA 설계 &middot; 이기승의 끄적끄적..
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
<link rel="stylesheet" href="/public/css/ntz4kiseung.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>
    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <!-- Profile -->
  <div class="sidebar-item sidebar-profile-box">
    <img class="sidebar-profile-image" src="/public/image/About Me/sidebar_profile.png" >
    <div class="sidebar-profile-description">
      <span>
        &nbsp;잡기에 능한 개발자입니다. 잡기보다 개발 실력이 좋아야 할 텐데 걱정입니다.
      </span>
    </div>
  </div>
  <!-- Profile End -->

  <nav class="sidebar-nav">
    <!-- Home -->
    <a class="sidebar-nav-item" href="/">Home</a>
    <!-- Home End -->
    <!-- Posts -->
    
    
      
        <!-- 1 depth post -->
        <a class="sidebar-nav-item" href="http://localhost:4000/posts/About Me">About Me</a>
      
    
      
        <!-- 1 depth post -->
        <a class="sidebar-nav-item" href="http://localhost:4000/posts/Daily Thoughts">Daily Thoughts</a>
      
    
      
        <input id="Projects" class="toggle" type="checkbox">
        <label for="Projects" class="lbl-toggle sidebar-nav-item" tabindex="0">Projects</label>
        <div class="collapsible-content subcategories">
        
          
            <!-- 2 depth post -->
            <a class="sidebar-nav-item" href="http://localhost:4000/posts/Projects/Sagyo_Reboot">Sagyo_Reboot</a>
          
        
          
            <!-- 2 depth post -->
            <a class="sidebar-nav-item" href="http://localhost:4000/posts/Projects/Twitch_Chat_Analysis">Twitch_Chat_Analysis</a>
          
        
          
            <!-- 2 depth post -->
            <a class="sidebar-nav-item" href="http://localhost:4000/posts/Projects/Hwangmaesan">Hwangmaesan</a>
          
        
          
            <!-- 2 depth post -->
            <a class="sidebar-nav-item" href="http://localhost:4000/posts/Projects/The_Oyster_Mine">The_Oyster_Mine</a>
          
        
        </div>
      
    
      
        <input id="Study" class="toggle" type="checkbox">
        <label for="Study" class="lbl-toggle sidebar-nav-item" tabindex="0">Study</label>
        <div class="collapsible-content subcategories">
        
          
            <!-- 2 depth post -->
            <a class="sidebar-nav-item" href="http://localhost:4000/posts/Study/Short_Books">Short_Books</a>
          
        
          
            <!-- 2 depth post -->
            <a class="sidebar-nav-item" href="http://localhost:4000/posts/Study/Algorithm">Algorithm</a>
          
        
          
            <!-- 2 depth post -->
            <a class="sidebar-nav-item" href="http://localhost:4000/posts/Study/Http The Definitive Guide">Http The Definitive Guide</a>
          
        
          
            <!-- 2 depth post -->
            <a class="sidebar-nav-item" href="http://localhost:4000/posts/Study/C_Kim_Pope">C_Kim_Pope</a>
          
        
          
            <!-- 2 depth post -->
            <a class="sidebar-nav-item" href="http://localhost:4000/posts/Study/MSA_Ken_Krueger">MSA_Ken_Krueger</a>
          
        
        </div>
      
    
      
        <input id="Googling" class="toggle" type="checkbox">
        <label for="Googling" class="lbl-toggle sidebar-nav-item" tabindex="0">Googling</label>
        <div class="collapsible-content subcategories">
        
          
            <!-- 2 depth post -->
            <a class="sidebar-nav-item" href="http://localhost:4000/posts/Googling/etc">etc</a>
          
        
          
            <!-- 2 depth post -->
            <a class="sidebar-nav-item" href="http://localhost:4000/posts/Googling/Java">Java</a>
          
        
          
            <!-- 2 depth post -->
            <a class="sidebar-nav-item" href="http://localhost:4000/posts/Googling/Spring">Spring</a>
          
        
          
            <!-- 2 depth post -->
            <a class="sidebar-nav-item" href="http://localhost:4000/posts/Googling/Data_Structure">Data_Structure</a>
          
        
          
            <!-- 2 depth post -->
            <a class="sidebar-nav-item" href="http://localhost:4000/posts/Googling/Network">Network</a>
          
        
        </div>
      
    
    <!-- Posts End -->
  </nav>

  <!-- sidebar bottom -->
  <div class="sidebar-item">
    <p>
      &copy; 2020. All rights reserved.
    </p>
  </div>
  <!-- sidebar bottom end -->
</div>

    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title" style="font-weight: normal;">
            <a href="/" title="Home">이기승의 끄적끄적..</a>
            <small>개발 및 잡다한 포스팅</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">디렉터리 구조 개편 및 MSA 설계</h1>
  <span class="post-date">28 Apr 2020</span>
  
<ul>
  <li> 저번에 폴더 구조를 개편 하려다가 DAO, Service, DTO, Map 등등.. 에 관해서만 조사하다가 끝났습니다. 어차피 MSA 구조를 적용하려면 폴더는 자연스럽게 개편될 것 같아 폴더 구조 개편은 멈추고 MSA에 관한 스터디를 먼저 진행했습니다.</li>
  <li> MSA 설계를 위해 Sagyo의 기존 파일들과 url을 분석하고 MSA에서 사용할 서비스와 url을 설계해봤습니다.</li>
</ul>

<h2 id="1-기존-sagyo-파일-분류">1. 기존 Sagyo 파일 분류</h2>

<hr />

<ul>
  <li>
    <p> 기존의 모든 *.java의 리스트를 뽑아봤더니  14개의 컨트롤러, 12개의 DAO, 14개의 DTO, 1개의 유틸 파일이 나왔습니다.</p>

    <table>
      <thead>
        <tr>
          <th>~Controller.java</th>
          <th>~DAO.java</th>
          <th>~DTO.java</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Badge</td>
          <td>IBadge</td>
          <td>Badge</td>
        </tr>
        <tr>
          <td>Cs</td>
          <td>ICs</td>
          <td>Cs</td>
        </tr>
        <tr>
          <td>Follow</td>
          <td>IFollow</td>
          <td>Follow</td>
        </tr>
        <tr>
          <td>Message</td>
          <td>IMessage</td>
          <td>Message</td>
        </tr>
        <tr>
          <td>LogIn</td>
          <td>IInter</td>
          <td>Inter</td>
        </tr>
        <tr>
          <td>Main</td>
          <td>IJoin</td>
          <td>Join</td>
        </tr>
        <tr>
          <td>FindIdPw</td>
          <td>IAddr</td>
          <td>Addr</td>
        </tr>
        <tr>
          <td>Mypage</td>
          <td>IPost</td>
          <td>Post</td>
        </tr>
        <tr>
          <td>MyProfile</td>
          <td>IReport</td>
          <td>Report</td>
        </tr>
        <tr>
          <td>PostReadHost</td>
          <td>IReview</td>
          <td>Review</td>
        </tr>
        <tr>
          <td>PostReadJoin</td>
          <td>IUser</td>
          <td>User</td>
        </tr>
        <tr>
          <td>PostWrite</td>
          <td>IWithdrawal</td>
          <td>Withdrawal</td>
        </tr>
        <tr>
          <td>Search</td>
          <td><strong>Util 클래스</strong>(*.java)</td>
          <td>PointLog</td>
        </tr>
        <tr>
          <td>Singup</td>
          <td>MorphemeAnalyze</td>
          <td>Search</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li> 2개의 DTO를 제외하곤 DAO와 DTO가 1:1 대응 됐습니다. 다만, 앞선 포스팅에서도 언급했듯이 DTO의 속성들이 많이 겹쳤습니다.</li>
  <li> 앞선 포스팅에선 테이블별로 VO, DAO를 구성하고 Service단에서 DAO를 엮으려 했으나 다음과 같은 이유로 지금처럼 테이블 기준이 아니라 필요한 속성들 기준으로 DTO를 구성하거나 Map을 사용할까 생각중입니다.
    <ul>
      <li> 테이블 정규화가 잘 되어있어 게시글 조회를 하는 데 5~6개의 테이블이 사용되어야 합니다.(게시글 기본 정보와 id로 참조 되어 있는 주소, 성별, 관심사, 댓글 등..)</li>
      <li> 뽑아온 데이터가 MSA의 여러 서비스를 다녀야 하니 개념상 VO보다 DTO가 맞는 것 같습니다.</li>
      <li> MSA의 서비스를 돌아다닐 땐 json으로 변환해야 하는데 여러 VO를 묶은 json을 전송하기 보단 하나의 DTO를 json으로 변환하는 게 맞는 것 같습니다.</li>
    </ul>
  </li>
</ul>

<h2 id="2-기존-url-분류">2. 기존 url 분류</h2>

<hr />

<ul>
  <li> 기존 컨트롤러들에서 요청 url들을 모두 정리해 보니 84개의 url이 나왔습니다. 너무 길어 포스팅에 담진 못하지만 <a href="/public/document/sagyo-controller-url.pdf">여기</a>에 올려둡니다.</li>
  <li> 정리해본 결과 몇 개의 논점을 뽑았습니다. 모든 논점이 제가 한 건 아니지만… 다들 비슷비슷한 실력이었기 때문에 다른 친구들의 실수도 기록하겠습니다.
    <ul>
      <li> 메서드를 명확히 하기
        <ul>
          <li> POST, UPDATE, DELETE 가 되어야 할 url이 GET으로 된 게 꽤 많이 있습니다. 작업자 6명 모두 메서드의 역할에 대해 명확히 이해하지 못한 것 같습니다.</li>
        </ul>
      </li>
      <li> 유사한 url 합칠지 고민
        <ul>
          <li> ‘내 프로필 조회’ url, ‘다른 사람 프로필 조회’url과 같이 유사한 기능의 url이 나뉘어져 있는데, 이를 하나의 url안에서 처리해도 될 것 같습니다.</li>
        </ul>
      </li>
      <li> url의 의미를 명확히하기 (어차피 REST url로 고치며 갈아 엎을 예정이지만 다음에 url 설계할 땐 주의하자는 뜻에서 남깁니다.)
        <ol>
          <li> 프로젝트 당시엔 문제 없었지만, 1년 뒤에 다시 보니 뭘 뜻하는 건지 짐작이 안되어 sql 쿼리문까지 가봐야 되는 url들이 있었습니다.</li>
          <li> 같은 url에 다른 메서드만 써도 되는데 아예 url을 갈라버린 경우도 있습니다.</li>
          <li> 전체 view를 리턴하는 지, 이미 로드된 페이지에 삽입 될 view를 ajax로 리턴하는 지, 0,1 값을 리턴하는 지 등을 url을 보고 알 수 있으면 좋겠습니다.</li>
          <li> <code class="highlighter-rouge">/do_something</code>, <code class="highlighter-rouge">/do_something2</code> 같은 최악의 네이밍도 보였습니다.</li>
        </ol>
      </li>
      <li> 불필요한 요청 줄이기
        <ul>
          <li> url을 둘러보다 보니 아래와 같은 과정이 보였습니다.
            <ul>
              <li> (브라우저) 전화번호 인증 번호 입력 <br />👉 (서버) 인증 번호 맞다면 인증 성공 코드 전송 <br />👉 (브라우저) 인증 번호 저장 요청 <br />👉 (서버) 인증번호 저장</li>
            </ul>
          </li>
          <li> 인증 번호가 맞다면 서버에서 바로 저장해도 되는 데, 왜 브라우저에서 다시 저장 요청을 보내게 했는지 모르겠습니다… 그리고 이와 같은 불필요한 요청이 몇 가지 더 보였습니다.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h2 id="3-필요한-service-목록">3. 필요한 Service 목록</h2>

<hr />

<ul>
  <li> MSA 강의와 현재 Sagyo의 기능을 바탕으로 필요한 서비스들을 모두 나열해 보았습니다.
    <ul>
      <li>웹 클라이언트 서버 - “web-client”</li>
      <li>API 게이트웨이 - “gateway” - Spring Cloud Zuul</li>
      <li>설정 파일 서버 - “config” - Spring Cloud Config</li>
      <li><del>설정 파일 자동 배포 - Spring Cloud Bus</del> (MSA 1차 완성 후 추가)</li>
      <li>인증서버 - “oauth” - Spring Security</li>
      <li>유저정보 - “user”
        <ul>
          <li><del>뱃지 CRUD - “badge”</del></li>
          <li><del>쪽지 CRUD - “message”</del></li>
          <li><del>팔로워 CRUD - “follow”</del></li>
        </ul>
      </li>
      <li>게시글 검색 - “search”</li>
      <li>게시글 CRUD - “post”
        <ul>
          <li><del>댓글(참여신청) CRUD - “reply”</del></li>
          <li><del>후기 CRUD - “review”</del></li>
        </ul>
      </li>
      <li>고객센터 - “contact”</li>
      <li>공통 코드 관리 - “common”</li>
    </ul>
  </li>
  <li> 총 9개의 서비스가 선정되었습니다. (14개로 했다가 과하게 나눈 것 같아 줄였습니다.)</li>
  <li> 각 서비스들 모두 1개의 인스턴스만 사용한다는 전제로 1차 완성을 한 뒤, 여러 인스턴스를 띄워 로드밸런서(Spring Cloud Ribbon), 서킷브레이커(Spring Cloud Hystrix)를 적용하고 설정 자동 배포 서비스도 추가 개발 할 예정입니다.</li>
</ul>

<p class="p_img"><img src="/public/image/Sagyo_Reboot/msa_sketch.png" alt="msa_sketch.png" /><small>간단한 스케치</small></p>

<h2 id="4-서비스별-기존-url-분류">4. 서비스별 기존 url 분류</h2>

<hr />

<ul>
  <li> REST url을 설계하기 전에 기존 url들을 MSA 서비스별로 분류했습니다. 결과는 <a href="/public/document/sagyo-controller-url-classify.pdf">여기</a>를 참조해주세요.</li>
</ul>

<h2 id="5-서비스별-rest-url---기존-url-개편-추가-url">5. 서비스별 REST url - 기존 url 개편, 추가 url</h2>

<hr />

<ul>
  <li> 기존 url들을 기반으로 불필요한 것들은 삭제 및 병합하고 새로 필요해진 url들을 추가했습니다.</li>
  <li> 기존에 84개의 url이 있었는데 개편후 오히려 79개로 줄었습니다!!?? 😳😳😳 개발 4~5개월 차 학생들이 만든 웹 서비스라 불필요한 url이 많았나 봅니다..</li>
  <li> 개발하면서 url은 필요하면 더 추가할 생각입니다. 제가 RESTful하게 url을 구성했는지 잘 모르겠습니다. 일단 현재 계획된 url은 <a href="/public/document/sagyo-rest-url.pdf">여기</a>를 참고해주세요.</li>
</ul>

<h2 id="6-개발-순서">6. 개발 순서</h2>

<hr />

<ul>
  <li> url을 구성할 땐 top-down 방식으로 설계했지만 개발은 bottom-up으로 진행합니다. (아무래도 테스트 가능한 작은 단위부터 만드는 게 마음이 놓일 것 같아서…)</li>
  <li> 개발은 DB 테이블, 다른 서비스가 조금 엮여 있는 순서인 contact - common - oauth - user - post - search - web-client - config - api gateway 순서로 진행하겠습니다.</li>
</ul>

</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/posts/study/algorithm/binary-search/">
            알고리즘 - 이진탐색 문제풀이 잡기술
            <small>10 Jun 2020</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/posts/googling/network/REST-API/">
            그런 REST API로 괜찮은가
            <small>10 Jun 2020</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/posts/study/algorithm/Kruskal/">
            알고리즘 - 크루스칼 알고리즘, Union-Find, 최소 신장 트리
            <small>09 Jun 2020</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
